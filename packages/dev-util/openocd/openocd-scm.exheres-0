# Copyright 2014 Jorge Aparicio
# Distributed under the terms of the GNU General Public License v2

SCM_jimtcl_REPOSITORY="http://repo.or.cz/r/jimtcl"
SCM_git2cl_REPOSITORY="http://repo.or.cz/r/git2cl.git"

SCM_SECONDARY_REPOSITORIES="jimtcl git2cl"

SCM_EXTERNAL_REFS="jimtcl:jimtcl tools/git2cl:git2cl"

require flag-o-matic
require github [ user=ntfreak ]

SUMMARY="Open On-Chip Debugger"
HOMEPAGE="http://sourceforge.net/projects/openocd"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS="
    ftdi [[ description = [ Build support for FTDI devices ] ]]
    parport [[ description = [ Build the parallel port driver ] ]]
"

DEPENDENCIES="
    build+run:
        virtual/usb:1
        ftdi? ( dev-libs/libftdi:1 )
"

DEFAULT_SRC_CONFIGURE_PARAMS=(
    --disable-werror
)

DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=(
    "ftdi openjtag_libftdi"
    "ftdi presto_libftdi"
    "ftdi usb_blaster_libftdi"
    ftdi
    parport
)

src_prepare() {
    default

    # point cc to the libftdi headers
    if option ftdi; then
        append-flags -I/usr/include/libftdi1
    fi

    edo ./bootstrap
}

